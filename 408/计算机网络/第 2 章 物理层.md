# 第 2 章 物理层

## Intro

【考纲内容】

（一）通信基础
信道、信号、带宽、码元、波特、速率、信源与信宿等基本概念
奈奎斯特定理与香农定理；编码与调制
电路交换、报文交换与分组交换：数据报与虚电路

（二）传输介质
双绞线、同轴电缆、光纤与无线传输介质；物理层接口的特性

（三）物理层设备
中继器；集线器

【复习提示】

物理层考虑的是怎样才能在连接各台计算机的传输媒体上传输数据比特流，而不是指具体的传输媒体。本章概念较多，易出选择题，且涉及一些通信原理，读者不太明白的地方可以参考一些相关书籍，通信部分的内容也并非考研重点。复习时应抓住重点，如[奈奎斯特定理](# 1. 奈奎斯特定理)和[香农定理](# 2. 香农定理)的应用、[编码与调制](# 0x02 编码与调制)技术、[数据交换方式](# 0x03 电路交换、报文交换与分组交换)，以及电路交换、报文交换与分组交换技术等。

### 重点

奈奎斯特定理：极限码元传输速率为 2W 波特，其中 W 是理想低通信道的带宽。若用 V 表示每个码元离散电平的数目（码元的离散电平数目是指有多少种不同的码元，比如有 16 种不同的码元，则需要 4 个二进制位，因此数据传输速率是码元传输速率的 4 倍），则极限数据率为
$$
理想低通信道下的极限数据传输速率=2W\log_2V（单位为b/s）
$$


香农定理：
$$
信道的极限数据传输速率= W\log_2(1 + \frac SN)  (单位为 b/s)
$$
式中，$W$ 为信道的带宽，$S$ 为信道所传输信号的平均功率，$N$ 为信道内部的高斯噪声功率。$S/N$ 为信噪比，即信号的平均功率与噪声的平均功率之比，$信噪比=10\log_{10}(S/N)$（单位为 dB）



## 一、通信基础

### 0x00 基本概念

#### 1. 数据、 信号与码元

通信的目的是传送信息，如文字、图像和视频等。数据是指传送信息的实体。**信号则是数据的电气或电磁表现**，是数据在传输过程中的存在形式。数据和信号都可用“模拟的”或“数字的”来修饰：

1. 连续变化的数据（或信号）称为**模拟数据**（或模拟信号）
2. 取值仅允许为有限的几个离散数值的数据（或信号）称为**数字数据**（或数字信号）。

数据传输方式可分为串行传输和并行传输。串行传输是指 1 比特 1 比特地按照时间顺序传输（**远距离通信通常采用串行传输**），并行传输是指若干比特通过多条通信信道同时传输。

码元是指用一个**固定时长的信号波形**（数字脉冲）表示一位 k 进制数字，代表不同离散数值的基本波形，是数字通信中数字信号的计量单位，这个时长内的信号称为 **k 进制码元**，而该时长称为**码元宽度**。1 码元可以携带若干比特的信息量。例如，在使用二进制编码时，只有两种不同的码元：一种代表 0 状态，另一种代表 1 状态。

#### 2. 信源、 信道与信宿

数据通信是指数字计算机或其他数字终端之间的通信。一个数据通信系统主要划分为**信源**、**信道**和**信宿**三部分。
信源是产生和发送数据的源头。
信宿是接收数据的终点，它们通常都是计算机或其他数字终端装置。发送端信源发出的信息需要通过变换器转换成适合于在信道上传输的信号，
而通过信道传输到接收端的信号先由反变换器转换成原始信息，再发送给信宿。

信道与电路并不等同，信道是信号的传输媒介。一个信道可视为一条线路的逻辑部件，一般用来表示向某个方向传送信息的介质，因此一条通信线路往往包含一条发送信道和一条接收信道。噪声源是信道上的噪声（即对信号的干扰）及分散在通信系统其他各处的噪声的集中表示。

图 2.1 所示为一个单向通信系统的模型。实际的通信系统大多为双向的，即往往包含一条发送信道和一条接收信道，信道可以进行双向通信。

![1](.\image\408_network\2-1.png)

信道按传输信号形式的不同，可分为传送模拟信号的**模拟信道**和传送数字信号的**数字信道**两大类：信道按传输介质的不同可分为无线信道和有线信道。

信道上传送的信号有基带信号和宽带信号之分。

- **基带信号**将数字信号 1 和 0 直接用两种不同的电压表示，然后送到数字信道上传输（称为基带传输）
- **宽带信号**将基带信号进行调制后形成**频分复用模拟信号**，然后送到模拟信道上传输（称为宽带传输）。

从通信双方信息的交互方式看，可分为三种基本方式：

1. **单向通信**。只有一个方向的通信而没有反方向的交互，仅需要一条信道。例如，无线电广播、电视广播就属于这种类型。
2. **半双工通信**。通信的双方都可以发送或接收信息，但任何一方都不能同时发送和接收信息，此时需要两条信道。
3. **全双工通信**。通信双方可以同时发送和接收信息，也需要两条信道。

信道的极限容量是指信道的最高码元传输速率或信道的极限信息传输速率。

#### 3.  速率、波特与带宽

**速率**也称**数据率**，指的是**数据传输速率**，表示单位时间内传输的数据量。可以用码元传输速率和信息传输速率表示。

1. 码元传输速率。又称**波特率**，它表示单位时间内数字通信系统所传输的码元个数（也可称为脉冲个数或信号变化的次数），单位是波特（Baud）。1 波特表示数字通信系统每秒传输一个**码元**。码元可以是多进制的，也可以是二进制的，码元速率与进制数无关。
2. 信息传输速率。又称信息速率、**比特率**等，它表示单位时间内数字通信系统传输的**二进制码元**个数（即比特数），单位是比特/秒（b/s）。

注意：波特和比特是两个不同的概念，码元传输速率也称调制速率、波形速率或符号速率。但码元传输速率与信息传输速率在数量上却又有一定的关系。若一个码元携带 n 比特的信息量，则 M 波特率的码元传输速率所对应的信息传输速率为 Mn 比特/秒。

> 一个码元可以被视作一定数量的比特的集合体

带宽原指信号具有的频带宽度，单位是赫兹（Hz）。在实际网络中，由于数据率是信道最重要的指标之一，而带宽与数据率存在数值上的互换关系，因此常用来表示网络的通信线路所能传输数据的能力。因此，带宽表示单位时间内从网络中的某一点到另一点所能通过的“最高数据率”显然，此时带宽的单位不再是Hz，而是b/s。

### 0x01 奈奎斯特定理与香农定理

#### 1. 奈奎斯特定理

具体的信道所能通过的频率范围总是有限的[^1]。信号中的许多高频分量往往不能通过信道，否则在传输中会衰减，导致接收端收到的信号波形失去码元之间的清晰界限，这种现象称为**码间串扰**。奈奎斯特（Nyquist）定理又称**奈氏准则**，它规定：在理想低通（没有噪声、带宽有限）的信道中，为了避免码间串扰，极限码元传输速率为 2W 波特，其中 W 是理想低通信道的带宽。若用 V 表示每个码元离散电平的数目（码元的离散电平数目是指有多少种不同的码元，比如有 16 种不同的码元，则需要 4 个二进制位，因此数据传输速率是码元传输速率的 4 倍），则极限数据率为
$$
理想低通信道下的极限数据传输速率=2W\log_2V（单位为b/s）
$$
对于奈氏准则，可以得出以下结论：

1. 在任何信道中，码元传输速率是有上限的。若传输速率超过此上限，就会出现严重的码间串扰问题，使得接收端不可能完全正确识别码元。
2. 信道的频带越宽（即通过的信号高频分量越多），就可用更高的速率进行码元的有效传输。
3. 奈氏准则给出了码元传输速率的限制，但并未对信息传输速率给出限制，即未对一个码元可以对应多少个二进制位给出限制。

由于码元传输速率受奈氏准则的制约，所以要提高数据传输速率，就必须**设法使每个码元携带更多比特的信息量**，此时就需要采用多元制的调制方法。

#### 2. 香农定理

香农（Shannon）定理给出了带宽受限且有高斯白噪声干扰[^2]的信道的极限数据传输速率，当用此速率进行传输时，可以做到不产生误差。香农定理定义为：
$$
信道的极限数据传输速率= Wlog_2(1 + S/N)  (单位为 b/s)
$$
式中，$W$ 为信道的带宽，$S$ 为信道所传输信号的平均功率，$N$ 为信道内部的高斯噪声功率。$S/N$ 为信噪比，即信号的平均功率与噪声的平均功率之比，$信噪比=10\log_{10}(S/N)$（单位为 dB），例如当 $S/N=10$ 时，信噪比为 10dB，而当 $S/N=1000$ 时，信噪比为 30dB。

对于香农定理，可以得出以下结论：

1. 信道的带宽或信道中的信噪比越大，信息的极限传输速率越高。
2. 对一定的传输带宽和一定的信噪比，信息传输速率的上限是确定的。
3. 只要信息传输速率低于信道的极限传输速率，就能找到某种方法来实现无差错的传输。
4. 香农定理得出的是极限信息传输速率，实际信道能达到的传输速率要比它低不少。

奈氏准则只考虑了带宽与极限码元传输速率的关系，而香农定理不仅考虑到了带宽，也考虑到了信噪比。这从另一个侧面表明，一个码元对应的二进制位数是有限的。

### 0x02 编码与调制

数据无论是数字的还是模拟的，为了传输的目的都必须转变成信号。把数据变换为模拟信号的过程称为**调制**，把数据变换为数字信号的过程称为**编码**。

信号是数据的具体表示形式，它和数据有一定的关系，但又和数据不同。数字数据可以通过数字发送器转换为数字信号传输，也可以通过调制器转换成模拟信号传输；同样，模拟数据可以通过 PCM 编码器转换成数字信号传输，也可以通过放大器调制器转换成模拟信号传输。这样，就形成了下列 4 种编码方式。

#### 1. 数字数据编码为数字信号

数字数据编码用于基带传输中，即在基本不改变数字数据信号频率的情况下，直接传输数字信号。具体用什么样的数字信号表示 0 及用什么样的数字信号表示 1 就是所谓的编码。编码的规则有多种，只要能有效地把 1 和 0 区分开即可，常用的数字数据编码有以下几种，如图 2.2 所示。

![2](.\image\408_network\2-2.png)

1. **归零编码**。在归零编码（RZ）中用高电平代表1、低电平代表0（或者相反），每个时钟周期的中间均跳变到低电平（归零），接收方根据该跳变调整本方的时钟基准，这就为传输双方提供了自同步机制。由于归零需要占用一部分带宽，因此传输效率受到了一定的影响。
2. **非归零编码**。非归零编码（NRZ）与 RZ 编码的区别是不用归零，一个周期可以全部用来传输数据。但 NRZ 编码无法传递时钟信号，双方难以同步，因此若想传输高速同步数据，则需要都带有时钟线。
3. **反向非归零编码**。反向非归零编码（NRZI）与 NRZ 编码的区别是用信号的翻转代表0、信号保持不变代表1。翻转的信号本身可以作为一种通知机制。这种编码方式集成了前两种编码的优点，既能传输时钟信号，又能尽量不损失系统带宽。USB2.0通信的编码方式就是NRZI编码。
4. **曼彻斯特编码。**曼彻斯特编码（Manchester Encoding）将一个码元分成两个相等的间隔、前一个间隔为高电平而后一个间隔为低电平表示码元 1；码元 0 的表示方法则刚好相反。当然，也可采用相反的规定。该编码的特点是，在每个码元的中间出现电平跳变，位中间的跳变既作为时钟信号（可用于同步），又作为数据信号，但它所占的频带宽度是原始基带宽度的两倍。
   **注意：以太网使用的编码方式就是曼彻斯特编码。**
5. **差分曼彻斯特编码**。差分曼彻斯特编码常用于局域网传输，其规则是：若码元为1，则前半个码元的电平与上一码元的后半个码元的电平相同；若码元为0，则情形相反。该编码的特点是，在每个码元的中间都有一次电平的跳转；可以实现自同步，且抗干扰性较好。
6. **4B/5B 编码**。将欲发送数据流的每 4 位作为一组，然后按照 4B/5B 编码规则将其转换成相应的5位码。5位码共32种组合，但只采用其中的16种对应16种不同的4位码，其他16种作为控制码（帧的开始和结束、线路的状态信息等）或保留。

#### 2. 数字数据调制为模拟信号

数字数据调制技术在发送端将数字信号转换为模拟信号，而在接收端将模拟信号还原为数字信号，分别对应于调制解调器的调制和解调过程。基本的数字调制方法有如下几种：

1. **幅移键控（ASK）**。通过改变载波信号的振幅来表示数字信号 1 和 0，而载波的频率和相位都不改变。比较容易实现，但抗干扰能力差。

2. **频移键控（FSK）**。通过改变载波信号的频率来表示数字信号 1 和 0，而载波的振幅和相位都不改变。容易实现，抗干扰能力强，目前应用较为广泛。

3. **相移键控（PSK）**。通过改变载波信号的相位来表示数字信号 1 和 0，而载波的振幅和频率都不改变。它又分为绝对调相和相对调相。

4. **正交振幅调制（QAM）**。在频率相同的前提下，将 ASK 与 PSK 结合起来，形成叠加信号。设波特率为B，采用m个相位，每个相位有n种振幅，则该QAM技术的数据传输速率R为
   $$
   R=B\log_2(mn)(单位为 b/s)
   $$
   

图 2.3 所示是二进制幅移键控、频移键控和相移键控的例子。2ASK 中用载波有幅度和无幅度分别表示数字数据的 1 和 0；2FSK 中用两种不同的频率分别表示数字数据 1 和 0 ；2PSK 中用相位 0 和相位 π 分别表示数字数据的 1 和 0，是一种绝对调相方式。

![3](.\image\408_network\2-3.png)

#### 3. 模拟数据编码为数字信号

这种编码方式最典型的例子是常用于对音频信号进行编码的**脉码调制（PCM）**。它主要包括三个步骤，即采样、量化和编码。

先来介绍采样定理：在通信领域，带宽是指信号最高频率与最低频率之差，单位为 Hz。因此，将模拟信号转换成数字信号时，假设原始信号中的最大频率为 f，那么采样频率 f~采样~ 必须大于或等于最大频率 f 的两倍，才能保证采样后的数字信号完整保留原始模拟信号的信息（只需记住结论)。另外，采样定理又称奈奎斯特定理。

1. 采样是指对模拟信号进行周期性扫描，把时间上连续的信号变成时间上离散的信号。根据采样定理，当采样的频率大于或等于模拟数据的频带带宽（最高变化频率）的两倍时，所得的离散信号可以无失真地代表被采样的模拟数据。
2. 量化是把采样取得的电平幅值按照一定的分级标度转化为对应的数字值并取整数，这样就把连续的电平幅值转换为了离散的数字量。采样和量化的实质就是分割和转换。
3. 编码是把量化的结果转换为与之对应的二进制编码

#### 4. 模拟数据调制为模拟信号

为了实现传输的有效性，可能需要较高的频率。这种调制方式还可以使用频分复用（FDM）技术，充分利用带宽资源。电话机和本地局交换机采用模拟信号传输模拟数据的编码方式，模拟的声音数据是加载到模拟的载波信号中传输的。



### 0x03 电路交换、报文交换与分组交换

#### 1. 电路交换

在数据进行传输前，两个结点之间必须先建立一条专用（双方独占）的物理通信路径（由通信双方之间的交换设备和链路逐段连接而成），改路径可能经过许多中间结点。**这一路径在整个数据传输期间一直被独占，直到通信结束后才被释放**。因此，电路交换技术分为三个阶段：连接建立、数据传输和连接释放。

从通信资源的分配角度来看，“交换”就是按照某种方式动态地分配传输线路的资源。电路交换的关键点是，在数据传输的过程中，用户始终占用端到端的固定传输带宽。

电路交换技术的优点如下：

1. 通信时延小。由于通信线路为通信双方用户专用，数据直达，因此传输数据的时延非常小。当传输的数据量较大时，这一优点非常明显
2. 有序传输。双方通信时按发送顺序传送数据，不存在失序问题。
3. 没有冲突。不同的通信双方拥有不同的信道，不会出现争用物理信道的问题。
4. 适用范围广。电路交换既适用于传输模拟信号，又适用于传输数字信号。
5. 实时性强。通信双方之间的物理通路一旦建立，双方就可以随时通信。
6. 控制简单。电路交换的交换设备（交换机等）及控制均较简单。

电路交换技术的缺点如下：

1. 建立连接时间长。电路交换的平均连接建立时间对计算机通信来说太长。
2. 线路独占，使用效率低。电路交换连接建立后，物理通路被通信双方独占，即使通信线路空闲，也不能供其他用户使用，因而信道利用率低。
3. 灵活性差。只要在通信双方建立的通路中的任何一点出了故障，就必须重新拨号建立新的连接，这对十分紧急和重要的通信是很不利的。
4. 难以规格化。电路交换时，数据直达，不同类型、不同规格、不同速率的终端很难相互进行通信，也难以在通信过程中进行差错控制。

注意，电路建立后，除源结点和目的结点外，电路上的任何结点都采取“直通方式”接收数据和发送数据，即不会存在存储转发所耗费的时间。

#### 2. 报文交换

数据交换的单位是报文，报文携带有目标地址、源地址等信息。报文交换在交换结点采用的是存储转发的传输方式。

报文交换技术的优点如下：

1. 无须建立连接。报文交换不需要为通信双方预先建立一条专用的通信线路，不存在建立连接时延，用户可以随时发送报文。
2. 动态分配线路。当发送方把报文交给交换设备时，交换设备先存储整个报文，然后选择一条合适的空闲线路，将报文发送出去。
3. 提高线路可靠性。如果某条传输路径发生故障，那么可重新选择另一条路径传输数据，因此提高了传输的可靠性。
4. 提高线路利用率。通信双方不是固定占有一条通信线路，而是在不同的时间一段一段地部分占有这条物理通道，因而大大提高了通信线路的利用率。
5. 提供多自标服务。一个报文可以同时发送给多个目的地址，这在电路交换中是很难实现的。

报文交换技术的缺点如下：

1. 由于数据进入交换结点后要经历存储、转发这一过程，因此会引起转发时延（包括接收报文、检验正确性、排队、发送时间等）。
2. 报文交换对报文的大小没有限制，这就要求网络结点需要有较大的缓存空间。

> 注意：报文交换主要使用在早期的电报通信网中，现在较少使用，通常被较先进的分组交换方式所取代。

#### 3. 分组交换

同报文交换一样，分组交换也采用存储转发方式，但解决了报文交换中大报文传输的问题。分组交换限制了每次传送的数据块大小的上限，把大的数据块划分为合理的小数据块，再加上一些必要的控制信息（如源地址、目的地址和编号信息等），构成分组（Packet）。网络结点根据控制信息把分组送到下一个结点，下一个结点接收到分组后，暂时保存并排队等待传输，然后根据分组控制信息选择它的下一个结点，直到到达目的结点。

分组交换的优点如下：

1. **无建立时延**。不需要为通信双方预先建立一条专用的通信线路，不存在连接建立时延，用户可随时发送分组。
2. **线路利用率高**。通信上方不是固定占有一条通信线路，而是在不同的时间一段一段地部分占有这条物理通路，因而大大提高了通信线路的利用率。
3. **简化了存储管理（相对于报文交换）**。因为分组的长度固定，相应的缓冲区的大小也固定，在交换结点中存储器的管理通常被简化为对缓冲区的管理，相对比较容易。
4. **加速传输**。分组是逐个传输的，可以使后一个分组的存储操作与前一个分组的转发操作并行，这种流水线方式减少了报文的传输时间。此外，传输一个分组所需的缓冲区比传输一次报文所需的缓冲区小得多，这样因缓冲区不足而等待发送的概率及时间也必然少得多。
5. **减少了出错概率和重发数据量**。因为分组较短，其出错概率必然减小，所以每次重发的数据量也就大大减少，这样不仅提高了可靠性，也减少了传输时延。

分组交换的缺点如下：

1. **存在存储转发时延**。尽管分组交换比报文交换的传输时延少，但相对于电路交换仍存在存储转发时延，而且其结点交换机必须具有更强的处理能力。
2. **需要传输额外的信息量**。每个小数据块都要加上源地址、目的地址和分组编号等信息，从而构成分组，因此使得传送的信息量增大了5%～10%，一定程度上降低了通信效率，增加了处理的时间，使控制复杂，时延增加。
3. 当分组交换采用数据报服务时，可能会出现失序、丢失或重复分组，分组到达目的结点时，要对分组按编号进行排序等工作，因此很麻烦。若采用虚电路服务，虽无失序问题，但有呼叫建立、数据传输和虚电路释放三个过程。

图 2.4 给出了三种数据交换方式的比较。要传送的数据量很大且其传送时间远大于呼叫时间时，采用电路交换较为合适。端到端的通路由多段链路组成时，采用分组交换传送数据较为合适。从提高整个网络的信道利用率上看，报文交换和分组交换优于电路交换，其中分组交换比报文交换的时延小，尤其适合于计算机之间的突发式数据通信。

![4](.\image\408_network\2-4.png)

### 0x04 数据报与虚电路

分组交换根据其通信子网向端点系统提供的服务，还可进一步分为面向连接的**虚电路方式**和无连接的**数据报方式**。这两种服务方式都由网络层提供。要注意数据报方式和虚电路方式是分组交换的两种方式。

#### 1. 数据报

作为通信子网用户的端系统发送一个报文时，在端系统中实现的高层协议先把报文拆成若干带有序号的数据单元，并在网络层加上地址等控制信息后形成数据报分组（即网络层的PDU）。中间结点存储分组很短一段时间，找到最佳的路由后，尽快转发每个分组。不同的分组可以走不同的路径，也可以按不同的顺序到达目的结点。

我们用图 2.5 的例子来说明数据报服务的原理。假定主机 A 要向主机 B 发送分组。

![5](.\image\408_network\2-5.png)

1. 主机 A 先将分组逐个发往与它直接相连的交换结点 A，交换结点 A 缓存收到的分组。
2. 然后查找自己的转发表。由于不同时刻的网络状态不同，因此转发表的内容可能不完全相同，所以有的分组转发给交换结点 C，有的分组转发给交换结点 D
3. 网络中的其他结点收到分组后，类似地转发分组，直到分组最终到达主机 B。

当分组正在某一链路上传送时，分组并不占用网络的其他部分资源。因为采用存储转发技术，资源是共享的，所以主机A在发送分组时，主机B也可同时向其他主机发送分组。

通过上面的例子，我们可以总结出数据报服务具有如下特点：

1. 发送分组前不需要建立连接。发送方可随时发送分组，网络中的结点可随时接收分组。
2. 网络尽最大努力交付，传输不保证可靠性，所以可能丢失；网络为每个分组独立地选择路由，转发的路径可能不同，因而分组不一定按序到达目的结点。
3. 发送的分组中要包括发送端和接收端的完整地址，以便可以独立传输。
4. 分组在交换结点存储转发时，需要排队等候处理，这会带来一定的时延。通过交换结点的通信量较大或网络发生拥塞时，这种时延会大大增加，交换结点还可根据情况丢弃部分分组。
5. 网络具有余路径，当某个交换结点或一条链路出现故障时，可相应地更新转发表，寻找另一条路径转发分组，对故障的适应能力强。
6. 存储转发的延时一般较小，提高了网络的吞吐量。
7. 收发双方不独占某条链路，资源利用率较高。

#### 2. 虚电路

虚电路方式试图将数据报方式与电路交换方式结合起来，充分发挥两种方法的优点，以达到最佳的数据交换效果。在分组发送之前，要求在发送方和接收方建立一条逻辑上相连的虚电路，并且连接一旦建立，就固定了虚电路所对应的物理路径。与电路交换类似，整个通信过程分为三个阶段：虚电路建立、数据传输与虚电路释放。

在虚电路方式中，端系统每次建立虚电路时，选择一个未用过的虚电路号分配给该虚电路，以区别于本系统中的其他虚电路。在传送数据时，每个数据分组不仅要有分组号、校验和等控制信息，还要有它要通过的虚电路号，以区别于其他虚电路上的分组。在虚电路网络中的每个结点上都维持一张虚电路表，表中的每项记录了一个打开的虚电路的信息，包括在接收链路和发送链路上的虚电路号、前一结点和下一结点的标识。数据的传输是双向进行的，上述信息是在虚电路的建立过程中确定的。

虚电路方式的工作原理如图2.6所示。

1. 为进行数据传输，主机 A 与主机 B 之间先建立一条逻辑通路，主机 A 发出一个特殊的“呼叫请求”分组，该分组通过中间结点送往主机B，若主机B同意连接，则发送“呼叫应答”分组予以确认。
2. 虚电路建立后，主机 A 就可以向主机 B 发送数据分组。当然，主机 B 也可在该虚电路上向主机 A 发送数据
3. 传送结束后主机 A 通过发送“释放请求”分组来拆除虚电路，逐段断开整个连接。

通过上面的例子，可以总结出虚电路服务具有如下特点：

1. 虚电路通信链路的建立和拆除需要时间开销，对交互式应用和小量的短分组情况显得很浪费，但对长时间、频繁的数据交换效率较高。
2. 虚电路的路由选择体现在连接建立阶段，连接建立后，就确定了传输路径。
3. 虚电路提供了可靠的通信功能，能保证每个分组正确且有序到达。此外，还可以对两个数据端点的流量进行控制，当接收方来不及接收数据时，可以通知发送方暂缓发送。
4. 虚电路有一个致命的弱点，即当网络中的某个结点或某条链路出现故障而彻底失效时，所有经过该结点或该链路的虚电路将遭到破坏。
5. 分组首部不包含目的地址，包含的是虚电路标识符，相对于数据报方式，其开销小。

![6](.\image\408_network\2-6.png)

虚电路之所以是“虚”的，是因为这条电路不是专用的，每个结点到其他结点之间的链路可能同时有若干虚电路通过，也可能同时与多个结点之间建立虚电路。每条虚电路支持特定的两个端系统之间的数据传输，两个端系统之间也可以有多条虚电路为不同的进程服务，这些虚电路的实际路由可能相同也可能不同。

注意，图 2.6 所示的数据传输过程是有确认的传输（由高层实现），主机 B 收到分组后要发回相应分组的确认。网络中的传输是否有确认与网络层提供的两种服务没有任何关系。

数据报服务和虚电路服务的比较：

|                    | 数据报服务                                           | 虚电路服务                                           |
| ------------------ | ---------------------------------------------------- | ---------------------------------------------------- |
| 连接的建立         | 不需要                                               | 必须有                                               |
| 目的地址           | 每个分组都有完整的目的地址                           | 仅在建立阶段使用，之后每个分组使用长度较短的虚电路号 |
| 路由选择           | 每个分组独立地进行路由选择和转发                     | 属于同一条虚电路的分组按照同一路由转发               |
| 分组顺序           | 不保证分组的有序到达                                 | 保证分组的有序到达                                   |
| 可靠性             | 不保证可靠通信，可靠性由用户主机来保证               | 可靠性由网络保证                                     |
| 对网络故障的适应性 | 结点丢失分组，其他分组路径选择发生变化时可以正常传输 | 所有经过故障结点的虚电路均不能正常工作               |
| 差错处理和流量控制 | 由用户主机进行流量控制，不保证数据报的可靠性         | 可由分组交换网负责，也可由用户主机负责               |



## 二、传输介质

### 0x00 双绞线、同轴电缆、光纤与无线传输介质

传输介质也称**传输媒体**，它是数据传输系统中发送设备和接收设备之间的物理通路。传输介质可分为导向传输介质和非导向传输介质。在导向传输介质中，电磁波被导向沿着固体媒介（铜线或光纤）传播，而非导向传输介质可以是空气、真空或海水等。

#### 1. 双绞线

双绞线是最常用的古老传输介质，它由两根采用一定规则并排绞合的、相互绝缘的铜导线组成。绞合可以减少对相邻导线的电磁干扰。为了进一步提高抗电磁干扰的能力，可在双绞线的外面再加上一层，即用金属丝编织成的屏蔽层，这就是屏蔽双绞线（STP）。无屏蔽层的双绞线称为非屏蔽双绞线（UTP）。它们的结构如图 2.7 所示。

![7](.\image\408_network\2-7.png)

双绞线的价格便宜，是最常用的传输介质之一，在局域网和传统电话网中普遍使用。双绞线的带宽取决于铜线的粗细和传输的距离。模拟传输和数字传输都可使用双绞线，其通信距离一般为几千米到数十千米。距离太远时，对于模拟传输，要用放大器放大衰减的信号；对于数字传输，要用中继器将失真的信号整形。

#### 2. 同轴电缆

同轴电缆由内导体、绝缘层、网状编织屏蔽层和塑料外层构成，如图 2.8 所示。按特性阻抗数值的不同，通常将同轴电缆分为两类：50Ω 同轴电缆和 75Ω 同轴电缆。其中，50Ω 同轴电缆主要用于传送基带数字信号，又称**基带同轴电缆**，它在局域网中应用广泛：75Ω 同轴电缆主要用于传送宽带信号，又称**宽带同轴电缆**，主要用于有线电视系统。

![8](.\image\408_network\2-8.png)

由于外导体屏蔽层的作用，同轴电缆具有良好的抗干扰特性，被广泛用于传输较高速率的数据，其传输距离更远，但价格较双绞线贵。

#### 3. 光纤

光纤通信就是利用光导纤维（简称光纤）传递光脉冲来进行通信。有光脉冲表示 1，无光脉冲表示 0。可见光的频率约为 10MHz，因此光纤通信系统的带宽范围极大。

光纤主要由纤芯和包层构成（见图 2.9），纤芯很细，其直径只有 8 至100μm，光波通过纤芯进行传导，包层较纤芯有较低的折射率。当光线从高折射率的介质射向低折射率的介质时，其折射角将大于入射角。因此，只要入射角大于某个临界角度，就会出现全反射，即光线碰到包层时就会折射回纤芯，这个过程不断重复，光也就沿着光纤传输下去。

![9](.\image\408_network\2-9.png)

利用光的全反射特性，可以将从不同角度入射的多条光线在一根光纤中传输，这种光纤称为多模光纤（见图2.10），多模光纤的光源为发光二极管。光脉冲在多模光纤中传输时会逐渐展宽，造成失真，因此多模光纤只适合于近距离传输。

![10](.\image\408_network\2-10.png)

光纤的直径减小到只有一个光的波长时，光纤就像一根波导那样，可使光线一直向前传播，而不会产生多次反射，这样的光纤就是单模光纤（见图 2.11）。单模光纤的纤芯很细，直径只有几微米，制造成本较高。同时，单模光纤的光源为定向性很好的半导体激光器，因此单模光纤的衰减较小，可传输数公里甚至数十千米而不必采用中继器，适合远距离传输。

![11](.\image\408_network\2-11.png)

光纤不仅具有通信容量非常大的优点，还具有如下特点：

1. 传输损耗小，中继距离长，对远距离传输特别经济。
2. 抗雷电和电磁干扰性能好。这在有大电流脉冲干扰的环境下尤为重要。
3. 无串音干扰，保密性好，也不易被窃听或截取数据。
4. 体积小，重量轻。这在现有电缆管道已拥塞不堪的情况下特别有利。

#### 4. 无线传输介质

无线通信已广泛应用于移动电话领域，构成蜂窝式无线电话网。随着便携式计算机的出现，以及在军事、野外等特殊场合下移动通信联网的需要，促进了数字化移动通信的发展，现在无线局域网产品的应用己非常普遍。

##### (1) 无线电波

无线电波具有较强的穿透能力，可以传输很长的距离，所以它被广泛应用于通信领域，如无线手机通信、计算机网络中的无线局域网（WLAN）等。因为无线电波使**信号向所有方向散播**，因此有效距离范围内的接收设备无须对准某个方向，就可与无线电波发射者进行通信连接，大大简化了通信连接。这也是无线电传输的最重要优点之一。

##### (2) 微波、红外线和激光

目前高带宽的无线通信主要使用三种技术：微波、红外线和激光。它们都需要发送方和接收方之间存在一条视线（Line-of-sight）通路，有很强的方向性，都沿直线传播，有时统称这三者为视线介质。不同的是，红外通信和激光通信把要传输的信号分别转换为各自的信号格式，即红外光信号和激光信号，再直接在空间中传播。

微波通信的频率较高，频段范围也很宽，载波频率通常为 2～40GHz，因而通信信道的容量大。例如，一个带宽为 2MHz 的频段可容纳500条语音线路，若用来传输数字信号，数据率可达数兆比特/秒。与通常的无线电波不同，微波通信的信号是沿直线传播的，因此在地面的传播距离有限，超过一定距离后就要用中继站来接力。

卫星通信利用地球同步卫星作为中继来转发微波信号，可以克服地面微波通信距离的限制。三颗相隔 120° 的同步卫星几乎能覆盖整个地球表面，因而基本能实现全球通信。卫星通信的优点是通信容量大、距离远、覆盖广，缺点是保密性差、端到端传播时延长。



### 0x01 物理层接口的特性

物理层考虑的是如何在连接到各种计算机的传输媒体上传输数据比特流，而不指具体的传输媒体。网络中的硬件设备和传输介质的种类繁多，通信方式也各不相同。物理层应尽可能屏蔽这些差异，让数据链路层感觉不到这些差异，使数据链路层只需考虑如何完成本层的协议和服务。

物理层的主要任务可以描述为确定与传输媒体的接口有关的一些特性：

1. 机械特性。指明接口所用接线器的形状和尺寸、引脚数目和排列、固定和锁定装置等。
2. 电气特性。指明在接口电缆的各条线上出现的电压的范围。
3. 功能特性。指明某条线上出现的某一电平的电压表示何种意义。
4. 过程特性。或称规程特性。指明对于不同功能的各种可能事件的出现顺序。

常用的物理层接口标准有 EIA RS-232-C、ADSL 和 SONET/SDH 等。



## 三、物理层设备

### 0x00 中继器

**中继器的主要功能是将信号整形并放大再转发出去**，以消除信号经过一长段电缆后而产生的失真和衰减，使信号的波形和强度达到所需要的要求，进而扩大网络传输的距离。其原理是信号再生（而非简单地将衰减的信号放大）。中继器有两个端口，数据从一个端口输入，再从另一个端口发出。端口仅作用于信号的电气部分，而不管是否有错误数据或不适于网段的数据。

中继器是用来扩大网络规模的最简单廉价的互连设备。中继器两端的网络部分是网段，而不是子网，使用中继器连接的几个网段仍然是一个局域网。中继器若出现故障，对相邻两个网段的工作都将产生影响。由于中继器工作在物理层，因此它不能连接两个具有不同速率的局域网。

> 注意：如果某个网络设备具有**存储转发**的功能，那么可以认为它能连接两个不同的协议：如果该网络设备没有存储转发功能，那么认为它不能连接两个不同的协议。中继器没有存储转发功能，因此它不能连接两个速率不同的网段，中继器两端的网段一定要使用同一个协议。

从理论上讲，中继器的使用数目是无限的，网络因而也可以无限延长。但事实上这不可能，因为网络标准中对信号的延迟范围做了具体的规定，中继器只能在此规定范围内进行有效的工作，否则会引起网络故障。例如，在采用粗同轴电缆的 10BASE5 以太网规范中，互相串联的中继器的个数不能超过 4 个，而且用 4 个中继器串联的 5 段通信介质中只有 3 段可以挂接计算机，其余两段只能用作扩展通信范围的链路段，不能挂接计算机。这就是所谓的 “5-4-3 规则”。

> 注意：放大器和中继器都起放大作用，只不过放大器放大的是模拟信号，原理是将衰减的信号放大，而中继器放大的是数字信号，原理是将衰减的信号整形再生。

### 0x01 集线器

集线器（Hub）实质上是一个多端口的中继器。当 Hub 工作时，一个端口接收到数据信号后，由于信号在从端口到 Hub 的传输过程中已有衰减，所以 Hub 便将该信号进行整形放大，使之再生（恢复）到发送时的状态，紧接着转发到其他所有（除输入端口外）处于工作状态的端口。如果同时有两个或多个端口输入，那么输出时会发生冲突，致使这些数据都无效。从Hub的工作方式可以看出，它在网络中只起信号放大和转发作用，目的是扩大网络的传输范围，而不具备信号的定向传送能力，即信息传输的方向是固定的，是一个标准的共享式设备。

Hub 主要使用双绞线组建共享网络，是从服务器连接到桌面的最经济方案。在交换式网络中，Hub直接与交换机相连，将交换机端口的数据送到桌面上。使用 Hub 组网灵活，它把所有结点的通信集中在以其为中心的结点上，对结点相连的工作站进行集中管理，不让出问题的工作站影响整个网络的正常运行，并且用户的加入和退出也很自由。由 Hub 组成的网络是共享式网络，但也只能在[半双工状态](# 2. 信源、 信道与信宿)下工作，网络的吞吐率因而受到限制。

> 注意：多台计算机必然会发生同时通信的情形，因此集线器不能分割冲突域，所有集线器的端口都属于同一个冲突域。集线器在一个时钟周期中只能传输一组信息，如果一台集线器连接的机器数目较多，且多台机器经常需要同时通信，那么将导致信息碰撞，使得集线器的工作效率很差。比如，一个带宽为 10Mb/s 的集线器上连接了 8 台计算机，当这 8 台计算机同时工作时，每台计算机真正所拥有的带宽为 10/8Mb/s= 1.25Mb/s。



## 四、本章疑难点

#### 1. 传输媒体是物理层吗？传输媒体和物理层的主要区别是什么？

传输媒体并不是物理层。由于传输媒体在物理层的下面，而物理层是体系结构的第一层，因此有时称传输媒体为 0 层。在传输媒体中传输的是信号，但传输媒体并不知道所传输的信号代表什么。也就是说，传输媒体不知道所传输的信号什么时候是 1 什么时候是 0。但物理层由于规定了电气特性，因此能够识别所传送的比特流。图 2.12 描述了上述概念。

![12](.\image\408_network\2-12.png)

#### 2. 什么是基带传输、频带传输和宽带传输？三者的区别是什么？

在计算机内部或在相邻设备之间近距离传输时，可以不经过调制就在信道上直接进行的传输方式称为基带传输。它通常用于局域网。数字基带传输就是在信道中直接传输数字信号，且传输媒体的整个带宽都被基带信号占用，双向地传输信息。最简单的方法是用两个高低电平来表示二进制数字，常用的编码方法有不归零编码和曼彻斯特编码。例如，要传输1010，低电平代表 0，高电平代表 1，那么在基带传输下，1010 需要向通信线路传输（高、低、高、低电平）。

用数字信号对特定频率的载波进行调制（数字调制），将其变成适合于传送的信号后再进行传输，这种传输方式就是频带传输。远距离传输或无线传输时，数字信号必须用频带传输技术进行传输。利用频带传输，不仅解决了电话系统传输数字信号的问题，而且可以实现多路复用，进而提高传输信道的利用率。同样传输1010，经过调制，一个码元对应4个二进制位，假设码元A代表1010，那么在模拟信道上传输码元A就相当于传输了1010，这就是频带传输。

借助频带传输，可将链路容量分解成两个或多个信道，每个信道可以携带不同的信号，这就是宽带传输。宽带传输中所有的信道能同时互不干扰地发送信号，链路容量大大增加。比如把信道进行频分复用，划分为2条互不相关的子信道，分别在两条子信道上同时进行频带传输，链路容量就大大增加了，这就是宽带传输。

#### 3. 如何理解同步和异步？什么是同步通信和异步通信？

在计算机网络中，同步（Symchronous）的意思很广泛，没有统一的定义。例如，协议的三个要素之一就是“同步”。在网络编程中常提到的“同步”则主要指某函数的执行方式，即函数调用者需等待函数执行完后才能进入下一步。异步（Asynchronous）可简单地理解为“非同步”。

在数据通信中，同步通信与异步通信区别较大。

发送和接收连续的同步比特流。主要有两种同步方式：

- 一种是全网同步，即用一个非常精确的主差，然后采用其他措施实现同步传输。同步通信数据率较高，但实现的代价也较高。
- 异步通信在发送字符时，所发送的字符之间的时间间隔可以是任意的，但接收端必须时刻做好接收的准备。发送端可以在任意时刻开始发送字符，因此必须在每个字符开始和结束的地方加上标志，即开始位和停止位，以便使接收端能够正确地将每个字符接收下来。异步通信也可以帧作为发送的单位。这时，帧的首部和尾部必须设有一些特殊的比特组合，使得接收端能够找出一帧的开始（即帧定界）。异步通信的通信设备简单、便宜；但传输效率较低（因为标志的开销所占比例较大）。图 2.13 给出了以字符、帧为单位的异步通信示意图。

![13](.\image\408_network\2-13.png)

#### 4. 奈氏准则和香农定理的主要区别是什么？这两个定理对数据通信的意义是什么？

奈氏准则指出，码元传输的速率是受限的，不能任意提高，否则接收端就不能正确判定码元所携带的比特是 1 还是 0（因为存在码元之间的相互干扰）。

奈氏准则是在理想条件下推导出来的。在实际条件下，最高码元传输速率要比理想条件下得出的数值小很多。电信技术人员的任务就是要在实际条件下，寻找出较好的传输码元波形，将比特转换为较为合适的传输信号。

需要注意的是，奈氏准则并未限制信息传输速率（b/s）。要提高信息传输速率，就必须使每个传输的码元能够代表许多比特的信息，这就需要有很好的编码技术。但码元所载的比特数确定后，信道的极限数据率也就确定了。

香农定理给出了信息传输速率的极限，即对于一定的传输带宽（单位为Hz）和一定的信噪比，信息传输速率的上限就确定了，这个极限是不能突破的。要想提高信息传输速率，要么设法提高传输线路的带宽，要么设法提高所传信道的信噪比，此外没有其他任何办法。

香农定理告诉我们，若要得到无限大的信息传输速率，只有两个办法：要么使用无限大的传输带宽（这显然不可能），要么使信号的信噪比无限大，即采用没有噪声的传输信道或使用无限大的发送功率（显然这也不可能）。注意，奈氏准则和香农定理中“带宽”的单位都是Hz。

#### 5. 信噪比为 S/N， 为什么还要取对数 $10\log_{10}(S/N)$ ?

1. 数字形式表示，即一般数值。如噪声功率为 1，信号功率为100，信噪比为100/1=100。

2. 以分贝形式表示，同样还是上面这些数字，以分贝形式表示的信噪比为
   $$
   10\log_{10}(S/N)=10\log_{10}100=20dB
   $$
   两者的区别在于，前者（数值）是没有单位的，后者必须加dB，代表分贝。两者数值上等价。

采用分贝表示的原因是：很多时候，信号要比噪声强得多，比如信号比噪声强10亿倍，如果用数值表示的话，那么1后面有9个0，很容易丢失一个0。如果用分贝表示，那么仅为90dB，因此要简单得多，而且不容易出错。分贝对于表示特别大或特别小的数值极为有利，这种表示方式在电子通信领域用途很广。

[^1]: 这里，频率应该理解成码元信号(电压信号)被发送到电缆上时的速率
[^2]: 高斯白噪声是具有高斯分布特性并且频谱特性均匀分布的随机噪声。在数字通信中，它是一种常见的干扰形式，影响了接收端对于信号的准确解析。例如，假如我们为一个码元定义四种状态，分别用四种电压值来表示（在这里我们简化成 -2V, -1V, 1V, 2V），那么这样一个码元就可以传输 2 bits 的信息。而在传输这样一个码元时，它会受到高斯白噪声干扰，这种干扰会干扰正在传输的电压值，干扰的程度遵循一个正态分布，而这个电压值可能会变成 1.5V，这样我们就很难判断原始的码元是 1V 还是 2V了
